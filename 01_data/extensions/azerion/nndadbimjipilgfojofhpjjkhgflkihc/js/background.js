(function(e){var t={};function s(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(r,a,function(t){return e[t]}.bind(null,a));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s(s.s=2)})({2:function(e,t,s){e.exports=s("fe77")},fe77:function(e,t){const s=5e3;let r={},a=null,o={};function i(e,t){r[e]=r[e]||{frames:{},cmp:{}},"undefined"!==typeof t&&(r[e].frames[t]=r[e].frames[t]||{slots:{}})}function n(e){r[e]&&delete r[e],o[e]&&delete o[e]}function d(e,t,s,a){if(r[t]&&r[t].frames[s]){const o=r[t].frames[s].slots;for(id of Object.keys(o))if(id!==e&&o[id].gamAdUnitPath===e)return id;const i=a.match(/(hb_uuid|hb_cache_id)=([^&]+)/);if(i){const t=i[2];for(id of Object.keys(o))if(id!==e&&o[id].bids.some(e=>e.rawBid.includes(t)))return id}}return null}function c(e){var t,s,r,a,o={},i=0,n=0,d="",c=String.fromCharCode,l=e.length,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(t=0;t<64;t++)o[m.charAt(t)]=t;for(r=0;r<l;r++){s=o[e.charAt(r)],i=(i<<6)+s,n+=6;while(n>=8)((a=i>>>(n-=8)&255)||r<l-2)&&(d+=c(a))}return d}chrome.tabs.onRemoved.addListener(async e=>{n(e)}),chrome.tabs.onUpdated.addListener(async(e,t)=>{"loading"===t.status&&n(e)}),chrome.runtime.onStartup.addListener(()=>{r={},o={}}),chrome.webRequest.onBeforeRequest.addListener(e=>{function t(e,t){if(!e||!e.length)return t;let s="VAST ad chain:\n";for(let r=0;r<e.length;r++)s+=`${r+1}. ${e[r]}\n`;return t&&(s+="\nPrebid bid JSON:\n"+t),s}function a(e,t){const s=o[e][t];return s[0].slotId}const n=e.tabId;let l=e.frameId;if(/imasdk.googleapis.com/.test(e.initiator)&&(l=e.parentFrameId),i(n),("undefined"===typeof r[n].cmp.improve||!0===r[n].cmp.improve)&&e.url.match(/(ice|ad).360yield.*.com\/(hb|pb|advast)/)){let t=!1;if("POST"===e.method){let s={};try{s=JSON.parse(e.requestBody.raw.map((function(e){return String.fromCharCode.apply(null,new Uint8Array(e.bytes))})).join(""))}catch(m){}s.user&&s.user.ext&&s.user.ext.consent&&(t=!0)}else e.url.match(/(gdpr%22%3A%22C|gdpr=)/)&&(t=!0);r[n].cmp.improve=t}if(/(pubads.g.doubleclick.net|pagead2.googlesyndication.com)\/gampad\/ads/.test(e.url)){if("undefined"!==typeof r[n].cmp.google&&!0!==r[n].cmp.google||(e.url.includes("gdpr_consent=C")?r[n].cmp.google=!0:r[n].cmp.google=!1),/output=(vast|xml_vast|xml_vmap)/.test(e.url)){i(n,l);const t=decodeURIComponent(e.url),a=/iu=([^&]*)/.exec(t)[1];let c=d(a,n,l,t);c?(r[n].frames[l].slots[a]&&delete r[n].frames[l].slots[a],r[n].frames[l].slots[c].gamAdUnitPath=a):(r[n].frames[l].slots[a]=r[n].frames[l].slots[a]||{bids:[]},r[n].frames[l].slots[a].gamAdUnitPath=a,c=a),r[n].frames[l].slots[c].bids=r[n].frames[l].slots[c].bids.filter(e=>"google"!==e.bidderCode),o[n]=o[n]||{},o[n][l]=o[n][l]||[];const m=Date.now();o[n][l]=o[n][l].filter(e=>e.dt>m-s),o[n][l].push({slotId:c,dt:m})}}else if(matches=e.url.match(/g.doubleclick.net\/pagead\/(conversion|interaction)\/\?.*label=(vast_creativeview|videoplayfailed\d*).*vci=([^&]*)/)){if(!matches)return;i(n,l);const e=matches[2];let s;/^videoplayfailed/.test(e)&&([s]=e.match(/\d+/)||[]);const o=c(matches[3]),d=o.replace(/[^A-Za-z0-9_.@\n]+/g," ").replaceAll(/@.*(\n|$)/g,"##").replaceAll("\n","").split("##").map(e=>(e=e.trim(),e=e.replace(/\b(\d{4}\w*?)2?\b/,"$1"),e.replace(/^\S?\W+/,"")));d.pop();const m=a(n,l),f=d.some(e=>e.includes("prebid"));if(f){const e=d.filter(e=>!e.includes("doubleclick")),a=[];for(const t of e){const e=t.match(/ (\w*\d{5}\w*)( |$)/);if(e){let t=e[1];a.push(t)}}const o=r[n].frames[l].slots[m].bids.find(e=>a.some(t=>e.rawBid.includes(t)));o?(o.rawBid=t(d,o.rawBid),o.winner=!s||"ERROR "+s):r[n].frames[l].slots[m].bids.push({bidderCode:s?"*SSP Error*":"*SSP Winner*",cpm:"",timeToRespond:"",mediaType:"video",size:"",winner:!s||"ERROR "+s,rawBid:t(d)})}else{const e={bidderCode:"google",cpm:"",timeToRespond:"",mediaType:"video",size:"",winner:!s||"ERROR "+s,rawBid:t(d)};r[n].frames[l].slots[m].bids.push(e)}chrome.runtime.sendMessage({type:"IDHBEX Update View",tabData:r[n]})}},{urls:["*://securepubads.g.doubleclick.net/gampad/ads*","*://pagead2.googlesyndication.com/gampad/ads*","*://pubads.g.doubleclick.net/*","*://*.g.doubleclick.net/pagead/conversion/*","*://*.g.doubleclick.net/pagead/interaction/*","*://*.360yield.com/*","*://*.360yield-basic.com/*"]},["requestBody"]),chrome.runtime.onMessage.addListener((e,t,s)=>{let o;return chrome.tabs.query({active:!0,currentWindow:!0},async n=>{if(!e.type||-1===e.type.search(/^idhbex/i))return;o=n.length>0?n[0].id:null,o?a=o:o=a;const d=t&&t.tab&&t.tab.id,c=t&&t.frameId;switch(d&&(i(d,c),r[d].frames[c].frameHost=e.frameHost,r[d].frames[c].frameSrc=e.frameSrc,r[d].frames[c].frameId=e.frameId),e.type){case"IDHBEX showPageAction":chrome.pageAction.show(d);break;case"IDHBEX Prebid auctionEnd":case"IDHBEX Prebid bidWon":if("IDHBEX Prebid bidWon"===e.type){let t=!1;r[d].frames[c].slots[e.slotId].bids.forEach(s=>{s.adId===e.bid.adId&&(s.winner=!0,t=!0)}),t||(e.bid.winner=!0,e.bid.isCachedBid=!0,r[d].frames[c].slots[e.slotId].bids.push(e.bid))}else Object.keys(e.bids).forEach(t=>{r[d].frames[c].slots[t]=r[d].frames[c].slots[t]||{},r[d].frames[c].slots[t].bids=e.bids[t].hbBids,e.bids[t].adUnitPath&&(r[d].frames[c].slots[t].gamAdUnitPath=e.bids[t].adUnitPath)});d===o&&chrome.runtime.sendMessage({type:"IDHBEX Update View",tabData:r[o]});break;case"IDHBEX GPT slotRenderEnded":const t=e.slotId;if(r[d].frames[c].slots[t]=r[d].frames[c].slots[t]||{bids:[]},r[d].frames[c].slots[t].bids.some(e=>"google"===e.bidderCode))break;if(e.adUnitPath&&(r[d].frames[c].slots[t].gamAdUnitPath=e.adUnitPath),!e.slotIsEmpty){let s=!1;r[d].frames[c].slots[t].bids.forEach(e=>{e.winner&&(s=!0)}),s||r[d].frames[c].slots[t].bids.push({bidderCode:"google",cpm:"n/a",timeToRespond:"n/a",mediaType:"n/a",size:`${e.adSize[0]}x${e.adSize[1]}`,winner:!0,rawBid:e.eventData})}d===o&&chrome.runtime.sendMessage({type:"IDHBEX Update View",tabData:r[o]});break;case"IDHBEX Request Data":s(r[o]);break;case"idhbex_r_cmp_adrequest":s(r[o].cmp);break}}),!0})}});